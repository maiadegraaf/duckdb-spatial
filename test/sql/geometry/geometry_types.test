require spatial

# Test text roundtrip for geometry types

statement ok
CREATE TABLE types (geom GEOMETRY);

statement ok
INSERT INTO types VALUES
    (ST_GeomFromText('POINT EMPTY')),
    (ST_GeomFromText('POINT(0 0)')),
    (ST_GeomFromText('LINESTRING EMPTY')),
    (ST_GeomFromText('LINESTRING(0 0, 1 1)')),
    (ST_GeomFromText('POLYGON EMPTY')),
    (ST_GeomFromText('POLYGON((0 0, 1 0, 1 1, 0 1, 0 0))')),
    (ST_GeomFromText('MULTIPOINT EMPTY')),
    (ST_GeomFromText('MULTIPOINT(0 0, 1 1)')),
    (ST_GeomFromText('MULTILINESTRING EMPTY')),
    (ST_GeomFromText('MULTILINESTRING((0 0, 1 1), (2 2, 3 3))')),
    (ST_GeomFromText('MULTIPOLYGON EMPTY')),
    (ST_GeomFromText('MULTIPOLYGON(((0 0, 1 0, 1 1, 0 1, 0 0)), ((2 2, 3 2, 3 3, 2 3, 2 2)))')),
    (ST_GeomFromText('GEOMETRYCOLLECTION EMPTY')),
    (ST_GeomFromText('GEOMETRYCOLLECTION(POINT(0 0), LINESTRING(0 0, 1 1))'));

query I
SELECT ST_AsText(geom) FROM types
----
POINT EMPTY
POINT (0 0)
LINESTRING EMPTY
LINESTRING (0 0, 1 1)
POLYGON EMPTY
POLYGON ((0 0, 1 0, 1 1, 0 1, 0 0))
MULTIPOINT EMPTY
MULTIPOINT (0 0, 1 1)
MULTILINESTRING EMPTY
MULTILINESTRING ((0 0, 1 1), (2 2, 3 3))
MULTIPOLYGON EMPTY
MULTIPOLYGON (((0 0, 1 0, 1 1, 0 1, 0 0)), ((2 2, 3 2, 3 3, 2 3, 2 2)))
GEOMETRYCOLLECTION EMPTY
GEOMETRYCOLLECTION (POINT (0 0), LINESTRING (0 0, 1 1))


query I
SELECT ST_GeometryType(geom) FROM types
----
POINT
POINT
LINESTRING
LINESTRING
POLYGON
POLYGON
MULTIPOINT
MULTIPOINT
MULTILINESTRING
MULTILINESTRING
MULTIPOLYGON
MULTIPOLYGON
GEOMETRYCOLLECTION
GEOMETRYCOLLECTION


query I
SELECT ST_GeometryType(ST_AsWKB(geom)) FROM types
----
POINT
POINT
LINESTRING
LINESTRING
POLYGON
POLYGON
MULTIPOINT
MULTIPOINT
MULTILINESTRING
MULTILINESTRING
MULTIPOLYGON
MULTIPOLYGON
GEOMETRYCOLLECTION
GEOMETRYCOLLECTION


# Conversions from GEOMETRY to 2D/3D types

query II
SELECT ST_GeomFromText('POINT (1 2)')::POINT_2D,
       (ST_GeomFromText('POINT (1 2)')::POINT_2D)::GEOMETRY
----
POINT (1 2)	POINT (1 2)

query II
SELECT ST_GeomFromText('POINT (1 2)')::POINT_3D,
       (ST_GeomFromText('POINT (1 2)')::POINT_3D)::GEOMETRY
----
POINT Z (1 2 0)	POINT Z (1 2 0)

query II
SELECt ST_GeomFromText('POINT Z (1 2 3)')::POINT_3D,
       (ST_GeomFromText('POINT Z (1 2 3)')::POINT_3D)::GEOMETRY
----
POINT Z (1 2 3)	POINT Z (1 2 3)

query II
SELECT ST_GeomFromText('LINESTRING (1 1, 2 2)')::LINESTRING_2D,
       (ST_GeomFromText('LINESTRING (1 1, 2 2)')::LINESTRING_2D)::GEOMETRY
----
LINESTRING (1 1, 2 2)	LINESTRING (1 1, 2 2)

query II
SELECT ST_GeomFromText('LINESTRING (1 1, 2 2)')::LINESTRING_3D,
       (ST_GeomFromText('LINESTRING (1 1, 2 2)')::LINESTRING_3D)::GEOMETRY
----
LINESTRING Z (1 1 0, 2 2 0)	LINESTRING Z (1 1 0, 2 2 0)

query II
SELECT ST_GeomFromText('LINESTRING Z (1 1 1, 2 2 2)')::LINESTRING_3D,
       (ST_GeomFromText('LINESTRING Z (1 1 1, 2 2 2)')::LINESTRING_3D)::GEOMETRY
----
LINESTRING Z (1 1 2, 2 2 2)	LINESTRING Z (1 1 2, 2 2 2)

query II
SELECT ST_GeomFromText('POLYGON((1 1, 2 2, 3 3, 1 1))')::POLYGON_2D,
       (ST_GeomFromText('POLYGON((1 1, 2 2, 3 3, 1 1))')::POLYGON_2D)::GEOMETRY
----
POLYGON ((1 1, 2 2, 3 3, 1 1))	POLYGON ((1 1, 2 2, 3 3, 1 1))

query II
SELECT ST_GeomFromText('POLYGON((1 1, 2 2, 3 3, 1 1))')::POLYGON_3D,
       (ST_GeomFromText('POLYGON((1 1, 2 2, 3 3, 1 1))')::POLYGON_3D)::GEOMETRY
----
POLYGON Z ((1 1 0, 2 2 0, 3 3 0, 1 1 0))	POLYGON Z ((1 1 0, 2 2 0, 3 3 0, 1 1 0))

query II
SELECT ST_GeomFromText('POLYGON((1 1 1, 2 2 2, 3 3 3, 1 1 1))')::POLYGON_3D,
       (ST_GeomFromText('POLYGON((1 1 1, 2 2 2, 3 3 3, 1 1 1))')::POLYGON_3D)::GEOMETRY
----
POLYGON Z ((1 1 1, 2 2 2, 3 3 3, 1 1 1))	POLYGON Z ((1 1 1, 2 2 2, 3 3 3, 1 1 1))


# Conversions between 2D/3D types

query II
SELECT (ST_GeomFromText('POINT (1 2)')::POINT_2D)::POINT_3D,
       (ST_GeomFromText('POINT (1 2)')::POINT_3D)::POINT_2D
----
POINT Z (1 2 0)	POINT (1 2)

query II
SELECT (ST_GeomFromText('LINESTRING (1 1, 2 2)')::LINESTRING_2D)::LINESTRING_3D,
       (ST_GeomFromText('LINESTRING (1 1, 2 2)')::LINESTRING_3D)::LINESTRING_2D
----
LINESTRING Z (1 1 0, 2 2 0)	LINESTRING (1 1, 2 2)

query II
SELECT (ST_GeomFromText('POLYGON((1 1, 2 2, 3 3, 1 1))')::POLYGON_2D)::POLYGON_3D,
       (ST_GeomFromText('POLYGON((1 1, 2 2, 3 3, 1 1))')::POLYGON_3D)::POLYGON_2D
----
POLYGON Z ((1 1 0, 2 2 0, 3 3 0, 1 1 0))	POLYGON ((1 1, 2 2, 3 3, 1 1))
